

Public TB As Date
Public dt_1 As Date


Private Sub Cell_1_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_1_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 1, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_2_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 2, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_3_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 3, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_4_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 4, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_5_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 5, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 1
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 2
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_3_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 3
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_4_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 4
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_5_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 5
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_6_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 6
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Cell_6_7_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
'Команда - закончить выбор даты и закрыть форму
Set_Дата 6, 7
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Label1_Click()
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Label2_Click()
dt_1 = Now
TB = CStr(DateValue(dt_1))
Unload Me
End Sub

Private Sub Label3_Click()
Cells(Str, Stlb).Value = ""
Unload Me
End Sub

Sub Label2_MouseDown(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label2.BorderColor = &HFFFFFF
    Label2.ForeColor = &HFFFFFF
    Label2.BackColor = &H8000&
End Sub
Sub Label2_MouseUp(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label2.BorderColor = &H8000&
    Label2.ForeColor = &H8000&
    Label2.BackColor = &HFFFFFF
End Sub

Sub Label1_MouseDown(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label1.BorderColor = &HFFFFFF
    Label1.ForeColor = &HFFFFFF
    Label1.BackColor = &H800000
End Sub
Sub Label1_MouseUp(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label1.BorderColor = &H800000
    Label1.ForeColor = &H800000
    Label1.BackColor = &HFFFFFF
End Sub

Sub Label3_MouseDown(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label3.BorderColor = &HFFFFFF
    Label3.ForeColor = &HFFFFFF
    Label3.BackColor = &HC0&
End Sub
Sub Label3_MouseUp(ByVal Button As Integer, _
ByVal Shift As Integer, ByVal X As Single, _
ByVal Y As Single)
    Label3.BorderColor = &HC0&
    Label3.ForeColor = &HC0&
    Label3.BackColor = &HFFFFFF
End Sub
Private Sub UserForm_Initialize()
dt_1 = Now
    'Заполнение списка ComboBox_Month
    ComboBox_Month.AddItem "Январь"
    ComboBox_Month.AddItem "Февраль"
    ComboBox_Month.AddItem "Март"
    ComboBox_Month.AddItem "Апрель"
    ComboBox_Month.AddItem "Май"
    ComboBox_Month.AddItem "Июнь"
    ComboBox_Month.AddItem "Июль"
    ComboBox_Month.AddItem "Август"
    ComboBox_Month.AddItem "Сентябрь"
    ComboBox_Month.AddItem "Октябрь"
    ComboBox_Month.AddItem "Ноябрь"
    ComboBox_Month.AddItem "Декабрь"
'Установка TextBox_Year
TextBox_Year.Value = Format(dt_1, "yyyy")
'Установка ComboBox_Month и календаря
Set_Mоnth (dt_1)
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
On Error Resume Next
If dt_1 <> 0 And TB <> 0 Then
Cells(Str, Stlb).Value = TB
End If
End Sub

Private Sub Set_Mоnth(MyDate As Date)
    'Установка ComboBox_Month и календаря
    MyYear = Year(MyDate)
    MyMonth = Month(MyDate)
    MyDay = Day(MyDate)
    ComboBox_Month.ListIndex = MyMonth - 1
    MyWeekDay = Weekday(DateSerial(MyYear, MyMonth, 1), vbMonday)
    MyCountDay = Day(DateSerial(MyYear, MyMonth + 1, 1) - 1)
    l_start = 2 - MyWeekDay
    For i = 1 To 6
        For j = 1 To 7
            If l_start >= 1 And l_start <= MyCountDay Then
                Me.Controls("Cell_" & i & "_" & j).Caption = l_start
            Else
                Me.Controls("Cell_" & i & "_" & j).Caption = ""
            End If
             If l_start = MyDay Then Set_On_Off CInt(i), CInt(j)
    l_start = l_start + 1
    Next j, i
    End Sub

Private Sub Set_Дата(iRow As Integer, jCol As Integer)
    'Команда - установить дату, выбранную в календаре
    If Me.Controls("Cell_" & iRow & "_" & jCol).Caption = "" Then dt_1 = 0: Exit Sub
    MyYear = Year(dt_1)
    MyMonth = Month(dt_1)
    MyDay = CInt(Me.Controls("Cell_" & iRow & "_" & jCol).Caption)
    dt_1 = DateSerial(MyYear, MyMonth, MyDay)
    'Установка TextBox_Year
    TextBox_Year.Value = Format(dt_1, "yyyy")
    'Установка ComboBox_Month и календаря
    Set_Mоnth (dt_1)
End Sub

Private Sub ComboBox_Month_Change()
    'Команда - установить дату, выбранную в календаре (смена месяца)
    MyYear = Year(dt_1)
    MyMonth = CInt(ComboBox_Month.ListIndex + 1)
    MyDay = Day(dt_1)
    MyCountDay = Day(DateSerial(MyYear, MyMonth + 1, 1) - 1)
    If MyDay > MyCountDay Then MyDay = MyCountDay
    dt_1 = DateSerial(MyYear, MyMonth, MyDay)
    'Установка TextBox_Year
    TextBox_Year.Value = Format(dt_1, "yyyy")
    'Установка ComboBox_Month и календаря
    Set_Mоnth (dt_1)
End Sub

Private Sub SpinButton_Year_SpinDown()
    'Команда - установить дату, выбранную в календаре (смена года -1)
    MyYear = Year(dt_1) - 1
    MyMonth = Month(dt_1)
    MyDay = Day(dt_1)
    MyCountDay = Day(DateSerial(MyYear, MyMonth + 1, 1) - 1)
    If MyDay > MyCountDay Then MyDay = MyCountDay
    dt_1 = DateSerial(MyYear, MyMonth, MyDay)
    'Установка TextBox_Year
    TextBox_Year.Value = Format(dt_1, "yyyy")
    'Установка ComboBox_Month и календаря
    Set_Mоnth (dt_1)
End Sub

Private Sub SpinButton_Year_SpinUp()
    'Команда - установить дату, выбранную в календаре (смена года +1)
    MyYear = Year(dt_1) + 1
    MyMonth = Month(dt_1)
    MyDay = Day(dt_1)
    MyCountDay = Day(DateSerial(MyYear, MyMonth + 1, 1) - 1)
    If MyDay > MyCountDay Then MyDay = MyCountDay
    dt_1 = DateSerial(MyYear, MyMonth, MyDay)
    'Установка TextBox_Year
    TextBox_Year.Value = Format(dt_1, "yyyy")
    'Установка ComboBox_Month и календаря
    Set_Mоnth (dt_1)
End Sub

Private Sub Cell_1_1_Click()
If Cell_1_1.Caption = "" Then Exit Sub
    Set_Дата 1, 1
End Sub
Private Sub Cell_1_2_Click()
If Cell_1_2.Caption = "" Then Exit Sub
    Set_Дата 1, 2
End Sub
Private Sub Cell_1_3_Click()
If Cell_1_3.Caption = "" Then Exit Sub
    Set_Дата 1, 3
End Sub
Private Sub Cell_1_4_Click()
If Cell_1_4.Caption = "" Then Exit Sub
    Set_Дата 1, 4
End Sub
Private Sub Cell_1_5_Click()
If Cell_1_5.Caption = "" Then Exit Sub
    Set_Дата 1, 5
End Sub
Private Sub Cell_1_6_Click()
If Cell_1_6.Caption = "" Then Exit Sub
    Set_Дата 1, 6
End Sub
Private Sub Cell_1_7_Click()
If Cell_1_7.Caption = "" Then Exit Sub
    Set_Дата 1, 7
End Sub
Private Sub Cell_2_1_Click()
If Cell_2_1.Caption = "" Then Exit Sub
    Set_Дата 2, 1
End Sub
Private Sub Cell_2_2_Click()
If Cell_2_2.Caption = "" Then Exit Sub
    Set_Дата 2, 2
End Sub
Private Sub Cell_2_3_Click()
If Cell_2_3.Caption = "" Then Exit Sub
    Set_Дата 2, 3
End Sub
Private Sub Cell_2_4_Click()
If Cell_2_4.Caption = "" Then Exit Sub
    Set_Дата 2, 4
End Sub
Private Sub Cell_2_5_Click()
If Cell_2_5.Caption = "" Then Exit Sub
    Set_Дата 2, 5
End Sub
Private Sub Cell_2_6_Click()
If Cell_2_6.Caption = "" Then Exit Sub
    Set_Дата 2, 6
End Sub
Private Sub Cell_2_7_Click()
If Cell_2_7.Caption = "" Then Exit Sub
    Set_Дата 2, 7
End Sub
Private Sub Cell_3_1_Click()
If Cell_3_1.Caption = "" Then Exit Sub
    Set_Дата 3, 1
End Sub
Private Sub Cell_3_2_Click()
If Cell_3_2.Caption = "" Then Exit Sub
    Set_Дата 3, 2
End Sub
Private Sub Cell_3_3_Click()
If Cell_3_3.Caption = "" Then Exit Sub
    Set_Дата 3, 3
End Sub
Private Sub Cell_3_4_Click()
If Cell_3_4.Caption = "" Then Exit Sub
    Set_Дата 3, 4
End Sub
Private Sub Cell_3_5_Click()
If Cell_3_5.Caption = "" Then Exit Sub
    Set_Дата 3, 5
End Sub
Private Sub Cell_3_6_Click()
If Cell_3_6.Caption = "" Then Exit Sub
    Set_Дата 3, 6
End Sub
Private Sub Cell_3_7_Click()
If Cell_3_7.Caption = "" Then Exit Sub
    Set_Дата 3, 7
End Sub
Private Sub Cell_4_1_Click()
If Cell_4_1.Caption = "" Then Exit Sub
    Set_Дата 4, 1
End Sub
Private Sub Cell_4_2_Click()
If Cell_4_2.Caption = "" Then Exit Sub
    Set_Дата 4, 2
End Sub
Private Sub Cell_4_3_Click()
If Cell_4_3.Caption = "" Then Exit Sub
    Set_Дата 4, 3
End Sub
Private Sub Cell_4_4_Click()
If Cell_4_4.Caption = "" Then Exit Sub
    Set_Дата 4, 4
End Sub
Private Sub Cell_4_5_Click()
If Cell_4_5.Caption = "" Then Exit Sub
    Set_Дата 4, 5
End Sub
Private Sub Cell_4_6_Click()
If Cell_4_6.Caption = "" Then Exit Sub
    Set_Дата 4, 6
End Sub
Private Sub Cell_4_7_Click()
If Cell_4_7.Caption = "" Then Exit Sub
    Set_Дата 4, 7
End Sub
Private Sub Cell_5_1_Click()
If Cell_5_1.Caption = "" Then Exit Sub
    Set_Дата 5, 1
End Sub
Private Sub Cell_5_2_Click()
If Cell_5_2.Caption = "" Then Exit Sub
    Set_Дата 5, 2
End Sub
Private Sub Cell_5_3_Click()
If Cell_5_3.Caption = "" Then Exit Sub
    Set_Дата 5, 3
End Sub
Private Sub Cell_5_4_Click()
If Cell_5_4.Caption = "" Then Exit Sub
    Set_Дата 5, 4
End Sub
Private Sub Cell_5_5_Click()
If Cell_5_5.Caption = "" Then Exit Sub
    Set_Дата 5, 5
End Sub
Private Sub Cell_5_6_Click()
If Cell_5_6.Caption = "" Then Exit Sub
    Set_Дата 5, 6
End Sub
Private Sub Cell_5_7_Click()
If Cell_5_7.Caption = "" Then Exit Sub
    Set_Дата 5, 7
End Sub
Private Sub Cell_6_1_Click()
If Cell_6_1.Caption = "" Then Exit Sub
    Set_Дата 6, 1
End Sub
Private Sub Cell_6_2_Click()
If Cell_6_2.Caption = "" Then Exit Sub
    Set_Дата 6, 2
End Sub
Private Sub Cell_6_3_Click()
If Cell_6_3.Caption = "" Then Exit Sub
    Set_Дата 6, 3
End Sub
Private Sub Cell_6_4_Click()
If Cell_6_4.Caption = "" Then Exit Sub
    Set_Дата 6, 4
End Sub
Private Sub Cell_6_5_Click()
If Cell_6_5.Caption = "" Then Exit Sub
    Set_Дата 6, 5
End Sub
Private Sub Cell_6_6_Click()
If Cell_6_6.Caption = "" Then Exit Sub
    Set_Дата 6, 6
End Sub
Private Sub Cell_6_7_Click()
If Cell_6_7.Caption = "" Then Exit Sub
    Set_Дата 6, 7
    End Sub

Private Sub Set_On_Off(iRow As Integer, jCol As Integer)
    If Me.Controls("Cell_" & iRow & "_" & jCol).Caption = "" Then Exit Sub
    ' Очистить все ячейки
    For i = 1 To 6
        For j = 1 To 7
            Me.Controls("Cell_" & i & "_" & j).BackColor = RGB(255, 255, 255)
            Me.Controls("Cell_" & i & "_" & j).BorderColor = RGB(255, 255, 255)
        Next j
    Next i
    ' Выделить текущую ячейку
    Me.Controls("Cell_" & iRow & "_" & jCol).BackColor = RGB(135, 206, 235)
End Sub

Private Sub UserForm_Terminate()

End Sub